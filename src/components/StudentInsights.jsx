import React, { useState, useEffect, useMemo } from 'react';
import {
  BarChart as ReBarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip as RechartsTooltip,
  Legend as RechartsLegend,
  PieChart,
  Pie,
  Cell,
  ResponsiveContainer,
} from 'recharts';
import { Users, Clock, Smile, Frown, BookOpen, Search } from 'lucide-react';

// --- Color Palette ---

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];

// --- Helper Functions for Data Parsing ---

// 제공된 원시 텍스트 데이터를 분석하여 구조화된 객체 배열로 변환합니다.
const parseRawData = (rawText) => {
  // 데이터가 "4학년", "5학년", "6학년"으로 시작하는 패턴을 이용해 분리합니다.
  // 정규식을 사용하여 학년 키워드 앞에 구분자를 넣고 자릅니다.
  const standardizedText = rawText.replace(/(4학년|5학년|6학년)/g, '|||$1');
  const rows = standardizedText.split('|||').filter((row) => row.trim().length > 10); // 너무 짧은 쓰레기값 제거
  return rows.map((row, index) => {
    let grade = '미상';
    if (row.includes('4학년')) grade = '4학년';
    else if (row.includes('5학년')) grade = '5학년';
    else if (row.includes('6학년')) grade = '6학년';
    // 스마트폰/게임 시간 추출
    let screenTime = '기타';
    if (row.includes('1시간 이하')) screenTime = '1시간 이하';
    else if (row.includes('2~3시간')) screenTime = '2~3시간';
    else if (row.includes('3~4시간')) screenTime = '3~4시간';
    else if (row.includes('5시간 이상')) screenTime = '5시간 이상';
    else if (row.includes('안한다')) screenTime = '안한다';
    // 걱정거리 추출
    let worry = '기타';
    const worries = ['외모', '성적', '공부', '버릇', '친구문제', '가족문제', '건강', '성격'];
    for (const w of worries) {
      if (row.includes(w)) {
        worry = w;
        break;
      }
    }
    // 학교 문제점 추출 (주요 키워드 기반)
    let schoolProblem = '기타/없음';
    if (row.includes('뛰어다닌다')) schoolProblem = '실내 뜀박질';
    else if (row.includes('욕을')) schoolProblem = '욕설/폭력';
    else if (row.includes('쓰레기')) schoolProblem = '쓰레기 투기';
    else if (row.includes('규칙')) schoolProblem = '규칙 위반';
    else if (row.includes('시설물')) schoolProblem = '시설물 훼손';
    // 자율시간 주제 (복수 가능하지만 텍스트 파싱의 한계로 대표 키워드 추출)
    let autonomyTopics = [];
    const topics = ['문화예술', '디지털', 'AI', '진로', '인성', '독서', '생태', '체육', '토의'];
    topics.forEach((t) => {
      if (row.includes(t)) autonomyTopics.push(t);
    });
    return {
      id: index,
      grade,
      screenTime,
      worry,
      schoolProblem,
      autonomyTopics: autonomyTopics.length > 0 ? autonomyTopics : ['기타'],
      raw: row.substring(0, 50) + '...', // 미리보기용
    };
  });
};

const Card = ({ title, icon: Icon, children, className }) => (
  <div className={`bg-white rounded-xl shadow-sm border border-gray-100 p-6 ${className}`}>
    <div className="flex items-center gap-2 mb-4">
      {Icon && <Icon className="w-5 h-5 text-blue-600" />}
      <h3 className="text-lg font-bold text-gray-800">{title}</h3>
    </div>
    {children}
  </div>
);

const StudentInsights = () => {
  const [data, setData] = useState([]);
  const [selectedGrade, setSelectedGrade] = useState('All'); // 'All', '4학년', '5학년', '6학년'
  // --- Initial Data Load ---
  useEffect(() => {
    // 사용자가 제공한 원본 데이터 (너무 길어서 파싱 로직에서 처리됨)
    const rawInput = `현재 여러분은 몇 학년에 다니고 있습니까?가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [창의적체험활동]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [국어]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [도덕]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [사회]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [수학]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [과학]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [체육]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [음악]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [미술]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [영어]가장 좋아하는 과목을 좋아하는 순서대로 3개만 고르시오 [실과(5~6학년)]학부모님께서 자신의 공부나 숙제 등을 얼마나 자주 확인하고 도와주십니까?일주일에 책은 어느 정도 읽습니까?즐겨 읽는 책은 어떤 종류입니까?어려운 문제나 걱정이 있으면 제일 먼저 누구와 의논하고 도움을 요청합니까?하루 동안 컴퓨터 게임, 인터넷, 스마트폰을 하는 시간은 모두 합하여 얼마나 됩니까?요즘 내가 가장 걱정하는 것을 한 가지만 고르시오여가휴식시간에는 주로 무엇을 하며 지냅니까?우리 학교 학생들의 좋은 점은 무엇이라고 생각합니까?2026학년도에는 4, 6학년에 학교자율시간이 적용됩니다. 특히 6학년 학생들은 디벗을 새롭게 접하게 됩니다. 학년군별로 가장 필요하다고 생각하는 학교자율시간 주제를 각각 2가지이내 선택해 주십시오.

*학교자율시간

지역과 학교의 여건 및 학생의 필요에 따라 교과 및 창의적 체험활동의 일부 시수를 확보하여 국가 교육과정에 제시되어 있는 교과 외 새로운 과목이나 활동을 개설하여 운영하는 시간우리 학교 학생들의 가장 큰 문제점은 무엇이라고 생각합니까?4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상동화책부모님1시간 이하외모독서실내에서 질서 있게 행동한다.문화예술, 디지털·AI실내에서 뛰어다닌다.4학년3순위1순위2순위매일 확인하고 도와주신다.1~2권위인전부모님1시간 이하버릇운동친구들과 사이 좋게 지낸다.디지털·AI학교 학급 규칙을 잘 안 지킨다.4학년1순위3순위2순위매일 확인하고 도와주신다.1~2권동화책부모님1시간 이하성격컴퓨터친구들과 사이 좋게 지낸다.문화예술, 인성쓰레기를 함부로 버린다.4학년2순위1순위3순위매일 확인하고 도와주신다.5권 이상위인전부모님2~3시간버릇운동친구들과 사이 좋게 지낸다.진로, 인성실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상소설, 문학책친구1시간 이하친구문제독서친구들과 사이 좋게 지낸다.독서·인문, 진로실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권위인전친구3~4시간공부핸드폰친구들과 사이 좋게 지낸다.디지털·AI, 태블릿으로 그림그리기쓰레기를 함부로 버린다.4학년3순위1순위2순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하외모운동친구들과 사이 좋게 지낸다.체육욕을 많이 하고 폭력적이다.4학년3순위1순위2순위가끔 확인하고 도와주신다.0권만화책친구3~4시간버릇핸드폰친구들과 사이 좋게 지낸다.진로, 인성실내에서 뛰어다닌다.4학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간성적운동친구들과 사이 좋게 지낸다.진로쓰레기를 함부로 버린다.4학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간가족문제운동친구들과 사이 좋게 지낸다.인성, 세계시민학교 학급 규칙을 잘 안 지킨다.4학년1순위3순위2순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하공부운동학교 학급 규칙을 잘 지킨다.인성, 세계시민쓰레기를 함부로 버린다.4학년3순위1순위2순위가끔 확인하고 도와주신다.3~4권위인전부모님5시간 이상건강운동친구들과 사이 좋게 지낸다.진로, 인성욕을 많이 하고 폭력적이다.4학년1순위가끔 확인하고 도와주신다.1~2권동화책부모님5시간 이상공부컴퓨터친구들과 사이 좋게 지낸다.게임실내에서 뛰어다닌다.4학년2순위1순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하친구문제독서학교 학급 규칙을 잘 지킨다.문화예술, 독서·인문실내에서 뛰어다닌다.4학년1순위3순위2순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모핸드폰친구들과 사이 좋게 지낸다.진로실내에서 뛰어다닌다.4학년1순위2순위3순위거의 도움 주시지 않는다.5권 이상과학책부모님1시간 이하건강독서학교 시설물을 아낀다.디지털·AI, 세계시민실내에서 뛰어다닌다.4학년3순위2순위1순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님안한다.성격운동친구들과 사이 좋게 지낸다.진로, 체육실내에서 뛰어다닌다.4학년3순위1순위2순위거의 도움 주시지 않는다.1~2권만화책부모님1시간 이하가족문제운동학교 시설물을 아낀다.디지털·AI, 알공학교 학급 규칙을 잘 안 지킨다.4학년3순위2순위1순위매일 확인하고 도와주신다.5권 이상만화책부모님안한다.성적운동실내에서 질서 있게 행동한다.인성욕을 많이 하고 폭력적이다.4학년3순위2순위1순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간친구문제TV 시청실내에서 질서 있게 행동한다.인성, 민주시민욕을 많이 하고 폭력적이다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상동화책부모님1시간 이하외모독서친구들과 사이 좋게 지낸다.독서·인문, 디지털·AI실내에서 뛰어다닌다.4학년1순위2순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님3~4시간공부TV 시청친구들과 사이 좋게 지낸다.독서·인문, 진로실내에서 뛰어다닌다.4학년3순위1순위2순위가끔 확인하고 도와주신다.3~4권만화책부모님2~3시간공부TV 시청친구들과 사이 좋게 지낸다.디지털·AI실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권위인전부모님1시간 이하외모운동학교 학급 규칙을 잘 지킨다.문화예술, 디지털·AI실내에서 뛰어다닌다.4학년3순위2순위1순위가끔 확인하고 도와주신다.3~4권소설, 문학책친구2~3시간성격TV 시청친구들과 사이 좋게 지낸다.문화예술, 인성쓰레기를 함부로 버린다.4학년1순위3순위2순위매일 확인하고 도와주신다.5권 이상동화책부모님2~3시간공부독서친구들과 사이 좋게 지낸다.디지털·AI욕을 많이 하고 폭력적이다.4학년2순위3순위1순위거의 도움 주시지 않는다.3~4권소설, 문학책친구3~4시간성격핸드폰친구들과 사이 좋게 지낸다.진로욕을 많이 하고 폭력적이다.4학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간친구문제핸드폰학교 시설물을 아낀다.진로, 인성실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하공부운동친구들과 사이 좋게 지낸다.디지털·AI쓰레기를 함부로 버린다.4학년2순위1순위3순위매일 확인하고 도와주신다.5권 이상과학책친구1시간 이하공부독서친구들과 사이 좋게 지낸다.디지털·AI실내에서 뛰어다닌다.4학년2순위1순위3순위거의 도움 주시지 않는다.1~2권만화책부모님2~3시간버릇운동친구들과 사이 좋게 지낸다.진로, 생태전환쓰레기를 함부로 버린다.4학년2순위3순위1순위매일 확인하고 도와주신다.1~2권만화책선생님1시간 이하공부핸드폰친구들과 사이 좋게 지낸다.디지털·AI욕을 많이 하고 폭력적이다.4학년2순위1순위3순위가끔 확인하고 도와주신다.3~4권위인전부모님1시간 이하공부핸드폰친구들과 사이 좋게 지낸다.진로실내에서 뛰어다닌다.4학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권동화책선생님1시간 이하공부핸드폰학교 시설물을 아낀다.옵션 10실내에서 뛰어다닌다.4학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권만화책부모님2~3시간친구문제TV 시청학교 시설물을 아낀다.진로,하지만 유명한사람이와서 교육해주는학교 학급 규칙을 잘 안 지킨다.4학년1순위3순위2순위거의 도움 주시지 않는다.1~2권소설, 문학책부모님3~4시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술, 독서·인문쓰레기를 함부로 버린다.4학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책선생님1시간 이하공부핸드폰친구들과 사이 좋게 지낸다.문화예술욕을 많이 하고 폭력적이다.4학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모운동친구들과 사이 좋게 지낸다.문화예술, 독서·인문실내에서 뛰어다닌다.4학년1순위2순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간버릇독서친구들과 사이 좋게 지낸다.문화예술, 디지털·AI실내에서 뛰어다닌다.6학년1순위3순위2순위가끔 확인하고 도와주신다.3~4권소설, 문학책친구5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.문화예술학교 시설물을 아끼지 않는다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.문화예술, 디지털·AI욕을 많이 하고 폭력적이다.6학년1순위2순위3순위거의 도움 주시지 않는다.1~2권만화책친구5시간 이상친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술실내에서 뛰어다닌다.6학년2순위3순위1순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님3~4시간버릇핸드폰친구들과 사이 좋게 지낸다.진로, 토의·토론학교 시설물을 아끼지 않는다.6학년2순위1순위3순위거의 도움 주시지 않는다.1~2권만화책친구5시간 이상성격운동친구들과 사이 좋게 지낸다.토의·토론욕을 많이 하고 폭력적이다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로학교 시설물을 아끼지 않는다.6학년1순위3순위2순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 토의·토론학교 시설물을 아끼지 않는다.6학년2순위3순위1순위거의 도움 주시지 않는다.1~2권소설, 문학책친구3~4시간공부핸드폰학교 학급 규칙을 잘 지킨다.인성, 토의·토론욕을 많이 하고 폭력적이다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구5시간 이상친구문제핸드폰학교 학급 규칙을 잘 지킨다.인성욕을 많이 하고 폭력적이다.6학년3순위1순위2순위거의 도움 주시지 않는다.1~2권위인전부모님1시간 이하공부TV 시청친구들과 사이 좋게 지낸다.독서·인문, 인성학교 학급 규칙을 잘 안 지킨다.6학년3순위1순위2순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간친구문제독서친구들과 사이 좋게 지낸다.독서·인문, 진로학교 시설물을 아끼지 않는다.6학년3순위1순위2순위매일 확인하고 도와주신다.1~2권소설, 문학책친구5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.인성, 토의·토론욕을 많이 하고 폭력적이다.6학년2순위3순위1순위가끔 확인하고 도와주신다.3~4권만화책부모님2~3시간건강TV 시청친구들과 사이 좋게 지낸다.진로, 디지털·AI학교 시설물을 아끼지 않는다.6학년3순위2순위1순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하건강운동친구들과 사이 좋게 지낸다.인성욕을 많이 하고 폭력적이다.6학년2순위3순위1순위가끔 확인하고 도와주신다.5권 이상만화책선생님1시간 이하건강독서친구들과 사이 좋게 지낸다.인성, 토의·토론학교 시설물을 아끼지 않는다.6학년2순위1순위3순위거의 도움 주시지 않는다.1~2권소설, 문학책형제3~4시간친구문제운동친구들과 사이 좋게 지낸다.토의·토론학교 시설물을 아끼지 않는다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권만화책부모님1시간 이하버릇핸드폰친구들과 사이 좋게 지낸다.진로학교 시설물을 아끼지 않는다.6학년2순위1순위3순위거의 도움 주시지 않는다.0권만화책친구5시간 이상건강핸드폰실내에서 질서 있게 행동한다.생태전환, 토의·토론욕을 많이 하고 폭력적이다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구5시간 이상버릇핸드폰친구들과 사이 좋게 지낸다.체육욕을 많이 하고 폭력적이다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간공부핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로학교 시설물을 아끼지 않는다.6학년3순위2순위1순위가끔 확인하고 도와주신다.0권만화책친구3~4시간건강핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로욕을 많이 하고 폭력적이다.6학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간가족문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 디지털·AI학교 시설물을 아끼지 않는다.6학년1순위2순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책친구5시간 이상친구문제핸드폰친구들과 사이 좋게 지낸다.진로, 인성실내에서 뛰어다닌다.6학년1순위3순위2순위거의 도움 주시지 않는다.1~2권소설, 문학책친구2~3시간건강핸드폰친구들과 사이 좋게 지낸다.독서·인문, 진로실내에서 뛰어다닌다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간공부핸드폰친구들과 사이 좋게 지낸다.기초소양, 세계시민쓰레기를 함부로 버린다.6학년3순위2순위1순위가끔 확인하고 도와주신다.3~4권소설, 문학책친구1시간 이하성격운동친구들과 사이 좋게 지낸다.토의·토론실내에서 뛰어다닌다.6학년1순위3순위2순위매일 확인하고 도와주신다.3~4권위인전부모님1시간 이하공부운동친구들과 사이 좋게 지낸다.디지털·AI, 세계시민욕을 많이 하고 폭력적이다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간공부핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.6학년2순위3순위1순위거의 도움 주시지 않는다.1~2권소설, 문학책부모님2~3시간건강독서친구들과 사이 좋게 지낸다.독서·인문, 진로욕을 많이 하고 폭력적이다.6학년2순위3순위1순위거의 도움 주시지 않는다.1~2권소설, 문학책부모님2~3시간공부TV 시청친구들과 사이 좋게 지낸다.디지털·AI실내에서 뛰어다닌다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간공부핸드폰친구들과 사이 좋게 지낸다.기초소양, 세계시민쓰레기를 함부로 버린다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간공부핸드폰친구들과 사이 좋게 지낸다.문화예술, 독서·인문실내에서 뛰어다닌다.6학년3순위1순위2순위매일 확인하고 도와주신다.1~2권만화책친구2~3시간공부운동친구들과 사이 좋게 지낸다.토의·토론학교 시설물을 아끼지 않는다.6학년1순위3순위2순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하외모핸드폰친구들과 사이 좋게 지낸다.디지털·AI, 생태전환학교 시설물을 아끼지 않는다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권만화책부모님3~4시간공부운동친구들과 사이 좋게 지낸다.진로욕을 많이 하고 폭력적이다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로실내에서 뛰어다닌다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간성적핸드폰친구들과 사이 좋게 지낸다.독서·인문, 기초소양욕을 많이 하고 폭력적이다.6학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간외모핸드폰친구들과 사이 좋게 지낸다.진로학교 학급 규칙을 잘 안 지킨다.6학년1순위3순위2순위가끔 확인하고 도와주신다.3~4권만화책친구5시간 이상성적운동친구들과 사이 좋게 지낸다.축구학교 학급 규칙을 잘 안 지킨다.6학년2순위1순위3순위거의 도움 주시지 않는다.1~2권소설, 문학책부모님2~3시간외모운동학교 시설물을 아낀다.독서·인문, 인성욕을 많이 하고 폭력적이다.5학년1순위2순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하성적독서학교 시설물을 아낀다.문화예술, 독서·인문학교 학급 규칙을 잘 안 지킨다.5학년1순위2순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간외모독서친구들과 사이 좋게 지낸다.인성, 토의·토론학교 학급 규칙을 잘 안 지킨다.5학년3순위1순위2순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간공부독서학교 시설물을 아낀다.디지털·AI, 생태전환욕을 많이 하고 폭력적이다.5학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간공부독서학교 시설물을 아낀다.디지털·AI, 토의·토론실내에서 뛰어다닌다.5학년2순위3순위1순위거의 도움 주시지 않는다.1~2권위인전친구5시간 이상성적핸드폰친구들과 사이 좋게 지낸다.인성, 토의·토론학교 학급 규칙을 잘 안 지킨다.5학년1순위3순위2순위거의 도움 주시지 않는다.1~2권소설, 문학책친구2~3시간공부TV 시청친구들과 사이 좋게 지낸다.진로학교 학급 규칙을 잘 안 지킨다.5학년1순위3순위2순위거의 도움 주시지 않는다.1~2권소설, 문학책형제5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.악기 배우기 (기타....)욕을 많이 하고 폭력적이다.5학년1순위거의 도움 주시지 않는다.1~2권만화책부모님2~3시간외모핸드폰친구들과 사이 좋게 지낸다.미술학교 시설물을 아끼지 않는다.5학년3순위2순위1순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로실내에서 뛰어다닌다.4학년3순위1순위2순위가끔 확인하고 도와주신다.0권소설, 문학책친구5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.문화예술, 인성쓰레기를 함부로 버린다.5학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.진로, 토의·토론학교 학급 규칙을 잘 안 지킨다.4학년3순위1순위거의 도움 주시지 않는다.0권만화책친구5시간 이상공부컴퓨터학교 학급 규칙을 잘 지킨다.게임욕을 많이 하고 폭력적이다.4학년1순위3순위2순위거의 도움 주시지 않는다.1~2권만화책부모님5시간 이상공부TV 시청친구들과 사이 좋게 지낸다.진로실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하공부독서친구들과 사이 좋게 지낸다.인성, 디지털·AI실내에서 뛰어다닌다.4학년3순위1순위2순위거의 도움 주시지 않는다.5권 이상위인전부모님2~3시간건강운동친구들과 사이 좋게 지낸다.문화예술, 진로실내에서 뛰어다닌다.5학년2순위1순위3순위거의 도움 주시지 않는다.1~2권소설, 문학책형제3~4시간건강핸드폰친구들과 사이 좋게 지낸다.문화예술, 독서·인문실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.3~4권만화책부모님2~3시간건강TV 시청친구들과 사이 좋게 지낸다.디지털·AI, 옵션 10학교 학급 규칙을 잘 안 지킨다.5학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님5시간 이상성적컴퓨터친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.5학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.진로, 토의·토론욕을 많이 하고 폭력적이다.4학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간공부운동친구들과 사이 좋게 지낸다.토의·토론욕을 많이 하고 폭력적이다.4학년3순위2순위1순위가끔 확인하고 도와주신다.3~4권만화책친구3~4시간친구문제핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI쓰레기를 함부로 버린다.4학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.진로쓰레기를 함부로 버린다.4학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권만화책선생님5시간 이상성격컴퓨터친구들과 사이 좋게 지낸다.토의·토론욕을 많이 하고 폭력적이다.4학년3순위2순위1순위거의 도움 주시지 않는다.5권 이상소설, 문학책형제2~3시간건강독서학교 시설물을 아낀다.진로, 세계시민쓰레기를 함부로 버린다.4학년1순위3순위2순위가끔 확인하고 도와주신다.5권 이상위인전부모님1시간 이하친구문제독서학교 학급 규칙을 잘 지킨다.진로, 인성욕을 많이 하고 폭력적이다.4학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권위인전부모님5시간 이상가족문제컴퓨터친구들과 사이 좋게 지낸다.디지털·AI, 세계시민실내에서 뛰어다닌다.4학년1순위2순위매일 확인하고 도와주신다.5권 이상만화책부모님1시간 이하공부독서친구들과 사이 좋게 지낸다.디지털·AI, 프러그램 코딩욕을 많이 하고 폭력적이다.4학년1순위2순위3순위가끔 확인하고 도와주신다.0권동화책선생님5시간 이상성적컴퓨터친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.4학년2순위3순위1순위가끔 확인하고 도와주신다.3~4권동화책형제2~3시간친구문제TV 시청학교 학급 규칙을 잘 지킨다.진로, 인성실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.3~4권만화책부모님5시간 이상친구문제핸드폰친구들과 사이 좋게 지낸다.디지털·AI학교 시설물을 아끼지 않는다.4학년1순위3순위2순위가끔 확인하고 도와주신다.0권만화책부모님5시간 이상버릇핸드폰친구들과 사이 좋게 지낸다.인성, 토의·토론실내에서 뛰어다닌다.4학년2순위3순위1순위가끔 확인하고 도와주신다.0권동화책부모님5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.진로실내에서 뛰어다닌다.4학년3순위2순위1순위거의 도움 주시지 않는다.5권 이상위인전부모님2~3시간성적컴퓨터친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님3~4시간친구문제컴퓨터실내에서 질서 있게 행동한다.제과제빵욕을 많이 하고 폭력적이다.5학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님5시간 이상건강핸드폰친구들과 사이 좋게 지낸다.디지털·AI, 기술력실내에서 뛰어다닌다.4학년1순위3순위2순위거의 도움 주시지 않는다.1~2권만화책부모님5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.디지털·AI, 재밌는 활동, 휴식쓰레기를 함부로 버린다.5학년2순위1순위3순위가끔 확인하고 도와주신다.3~4권만화책부모님2~3시간공부핸드폰친구들과 사이 좋게 지낸다.독서·인문, 인성학교 학급 규칙을 잘 안 지킨다.4학년2순위3순위1순위매일 확인하고 도와주신다.1~2권과학책부모님1시간 이하공부운동친구들과 사이 좋게 지낸다.독서·인문, 인성쓰레기를 함부로 버린다.4학년2순위1순위3순위거의 도움 주시지 않는다.1~2권위인전부모님2~3시간건강운동실내에서 질서 있게 행동한다.생태전환실내에서 뛰어다닌다.4학년1순위3순위2순위매일 확인하고 도와주신다.1~2권만화책친구1시간 이하공부TV 시청친구들과 사이 좋게 지낸다.문화예술, 디지털·AI실내에서 뛰어다닌다.4학년3순위2순위1순위거의 도움 주시지 않는다.1~2권만화책부모님1시간 이하성격운동친구들과 사이 좋게 지낸다.진로, 인성쓰레기를 함부로 버린다.4학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님3~4시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술, 디지털·AI욕을 많이 하고 폭력적이다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하버릇독서학교 학급 규칙을 잘 지킨다.독서·인문, 디지털·AI실내에서 뛰어다닌다.4학년1순위3순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하성적핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상위인전친구1시간 이하공부TV 시청친구들과 사이 좋게 지낸다.진로쓰레기를 함부로 버린다.6학년3순위1순위2순위거의 도움 주시지 않는다.1~2권동화책친구5시간 이상성적핸드폰실내에서 질서 있게 행동한다.진로실내에서 뛰어다닌다.4학년3순위2순위1순위매일 확인하고 도와주신다.3~4권만화책부모님2~3시간건강독서학교 학급 규칙을 잘 지킨다.디지털·AI, 세계시민실내에서 뛰어다닌다.4학년3순위2순위1순위가끔 확인하고 도와주신다.5권 이상동화책친구2~3시간버릇TV 시청친구들과 사이 좋게 지낸다.문화예술, 디지털·AI학교 학급 규칙을 잘 안 지킨다.4학년3순위2순위1순위매일 확인하고 도와주신다.1~2권만화책부모님1시간 이하공부핸드폰학교 학급 규칙을 잘 지킨다.진로, 세계시민실내에서 뛰어다닌다.5학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간성적핸드폰학교 시설물을 아낀다.문화예술, 진로욕을 많이 하고 폭력적이다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.문화예술, 인성학교 학급 규칙을 잘 안 지킨다.4학년2순위1순위매일 확인하고 도와주신다.3~4권동화책부모님2~3시간건강핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI학교 학급 규칙을 잘 안 지킨다.4학년3순위1순위2순위거의 도움 주시지 않는다.3~4권만화책부모님2~3시간공부TV 시청친구들과 사이 좋게 지낸다.민주시민, 디지털·AI학교 시설물을 아끼지 않는다.5학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술학교 학급 규칙을 잘 안 지킨다.4학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간공부운동학교 시설물을 아낀다.생태전환쓰레기를 함부로 버린다.4학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권과학책선생님5시간 이상성적핸드폰학교 학급 규칙을 잘 지킨다.디지털·AI실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책선생님2~3시간버릇TV 시청친구들과 사이 좋게 지낸다.디지털·AI, 토의·토론실내에서 뛰어다닌다.5학년1순위3순위2순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간건강TV 시청친구들과 사이 좋게 지낸다.독서·인문, 토의·토론실내에서 뛰어다닌다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간친구문제핸드폰학교 시설물을 아낀다.진로, 인성욕을 많이 하고 폭력적이다.4학년3순위1순위2순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님안한다.성적TV 시청친구들과 사이 좋게 지낸다.인성, 디지털·AI실내에서 뛰어다닌다.5학년3순위1순위2순위가끔 확인하고 도와주신다.0권동화책친구5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.인성욕을 많이 하고 폭력적이다.5학년3순위2순위1순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하공부핸드폰학교 시설물을 아낀다.문화예술욕을 많이 하고 폭력적이다.4학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권만화책부모님1시간 이하성적핸드폰친구들과 사이 좋게 지낸다.독서·인문실내에서 뛰어다닌다.4학년2순위3순위1순위가끔 확인하고 도와주신다.3~4권과학책부모님1시간 이하건강핸드폰학교 학급 규칙을 잘 지킨다.진로, 생태전환쓰레기를 함부로 버린다.5학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님5시간 이상건강TV 시청친구들과 사이 좋게 지낸다.진로실내에서 뛰어다닌다.5학년1순위3순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간성적운동친구들과 사이 좋게 지낸다.독서·인문, 디지털·AI욕을 많이 하고 폭력적이다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님5시간 이상공부핸드폰학교 학급 규칙을 잘 지킨다.디지털·AI, 체육욕을 많이 하고 폭력적이다.5학년2순위1순위3순위매일 확인하고 도와주신다.5권 이상위인전부모님2~3시간공부TV 시청실내에서 질서 있게 행동한다.세계시민욕을 많이 하고 폭력적이다.5학년2순위3순위1순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님3~4시간건강TV 시청학교 시설물을 아낀다.진로, 디지털·AI욕을 많이 하고 폭력적이다.5학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모핸드폰친구들과 사이 좋게 지낸다.수영실내에서 뛰어다닌다.5학년1순위2순위3순위매일 확인하고 도와주신다.1~2권위인전부모님2~3시간공부TV 시청학교 학급 규칙을 잘 지킨다.문화예술실내에서 뛰어다닌다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권위인전부모님1시간 이하건강운동실내에서 질서 있게 행동한다.문화예술실내에서 뛰어다닌다.5학년2순위3순위1순위가끔 확인하고 도와주신다.3~4권만화책부모님2~3시간성격핸드폰친구들과 사이 좋게 지낸다.독서·인문, 인성실내에서 뛰어다닌다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구3~4시간공부TV 시청친구들과 사이 좋게 지낸다.인성쓰레기를 함부로 버린다.5학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하건강독서친구들과 사이 좋게 지낸다.문화예술, 진로학교 시설물을 아끼지 않는다.5학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권만화책친구5시간 이상외모핸드폰학교 시설물을 아낀다.진로, 민주시민욕을 많이 하고 폭력적이다.5학년2순위1순위3순위거의 도움 주시지 않는다.0권소설, 문학책친구2~3시간성적핸드폰친구들과 사이 좋게 지낸다.진로, 정치욕을 많이 하고 폭력적이다.5학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모TV 시청친구들과 사이 좋게 지낸다.문화예술학교 학급 규칙을 잘 안 지킨다.5학년1순위3순위2순위가끔 확인하고 도와주신다.5권 이상소설, 문학책친구1시간 이하공부운동친구들과 사이 좋게 지낸다.문화예술, 진로학교 학급 규칙을 잘 안 지킨다.6학년2순위3순위1순위매일 확인하고 도와주신다.3~4권만화책친구2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 디지털·AI학교 시설물을 아끼지 않는다.6학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하공부핸드폰친구들과 사이 좋게 지낸다.문화예술, 독서·인문학교 시설물을 아끼지 않는다.6학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간성격운동친구들과 사이 좋게 지낸다.독서·인문, 진로욕을 많이 하고 폭력적이다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.진로학교 학급 규칙을 잘 안 지킨다.6학년1순위2순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책친구2~3시간가족문제핸드폰학교 학급 규칙을 잘 지킨다.진로, 디지털·AI욕을 많이 하고 폭력적이다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간공부핸드폰학교 학급 규칙을 잘 지킨다.문화예술, 진로욕을 많이 하고 폭력적이다.6학년2순위3순위1순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하공부독서학교 학급 규칙을 잘 지킨다.토의·토론, 장문욕을 많이 하고 폭력적이다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권위인전부모님5시간 이상공부TV 시청학교 시설물을 아낀다.진로, 디지털·AI실내에서 뛰어다닌다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하공부TV 시청친구들과 사이 좋게 지낸다.진로, 인성실내에서 뛰어다닌다.6학년1순위3순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하공부독서친구들과 사이 좋게 지낸다.진로, 토의·토론욕을 많이 하고 폭력적이다.6학년1순위3순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간공부컴퓨터학교 시설물을 아낀다.세계시민쓰레기를 함부로 버린다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님3~4시간공부핸드폰친구들과 사이 좋게 지낸다.진로, 인성욕을 많이 하고 폭력적이다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.독서·인문학교 학급 규칙을 잘 안 지킨다.6학년3순위2순위1순위거의 도움 주시지 않는다.1~2권소설, 문학책친구5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.독서·인문, 진로욕을 많이 하고 폭력적이다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권위인전부모님3~4시간공부핸드폰학교 학급 규칙을 잘 지킨다.문화예술, 인성학교 시설물을 아끼지 않는다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간성적핸드폰학교 학급 규칙을 잘 지킨다.문화예술, 디지털·AI학교 시설물을 아끼지 않는다.6학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간성격핸드폰친구들과 사이 좋게 지낸다.문화예술, 인성욕을 많이 하고 폭력적이다.6학년2순위1순위3순위거의 도움 주시지 않는다.1~2권소설, 문학책부모님2~3시간버릇핸드폰학교 시설물을 아낀다.문화예술, 세계시민실내에서 뛰어다닌다.6학년3순위1순위2순위거의 도움 주시지 않는다.3~4권위인전부모님3~4시간성적컴퓨터친구들과 사이 좋게 지낸다.문화예술, 디지털·AI욕을 많이 하고 폭력적이다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간건강TV 시청학교 학급 규칙을 잘 지킨다.진로, 인성욕을 많이 하고 폭력적이다.6학년3순위1순위2순위매일 확인하고 도와주신다.1~2권만화책형제3~4시간성적독서실내에서 질서 있게 행동한다.문화예술, 토의·토론실내에서 뛰어다닌다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로욕을 많이 하고 폭력적이다.6학년3순위2순위1순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하공부독서친구들과 사이 좋게 지낸다.독서·인문, 디지털·AI학교 학급 규칙을 잘 안 지킨다.6학년2순위1순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간공부독서친구들과 사이 좋게 지낸다.문화예술학교 학급 규칙을 잘 안 지킨다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권위인전부모님1시간 이하성적핸드폰학교 학급 규칙을 잘 지킨다.인성, 세계시민학교 시설물을 아끼지 않는다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간외모핸드폰친구들과 사이 좋게 지낸다.진로, 인성욕을 많이 하고 폭력적이다.6학년2순위1순위3순위거의 도움 주시지 않는다.1~2권만화책부모님2~3시간버릇핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로학교 학급 규칙을 잘 안 지킨다.6학년1순위2순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하친구문제독서친구들과 사이 좋게 지낸다.인성학교 시설물을 아끼지 않는다.6학년2순위3순위1순위매일 확인하고 도와주신다.1~2권위인전부모님5시간 이상공부운동친구들과 사이 좋게 지낸다.독서·인문, 디지털·AI실내에서 뛰어다닌다.6학년3순위1순위2순위가끔 확인하고 도와주신다.0권만화책친구5시간 이상공부핸드폰친구들과 사이 좋게 지낸다.인성욕을 많이 하고 폭력적이다.6학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권과학책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술, 기초소양학교 시설물을 아끼지 않는다.6학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간성적핸드폰실내에서 질서 있게 행동한다.없다학교 시설물을 아끼지 않는다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간외모핸드폰친구들과 사이 좋게 지낸다.독서·인문학교 시설물을 아끼지 않는다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간공부핸드폰학교 시설물을 아낀다.문화예술, 음악욕을 많이 하고 폭력적이다.6학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권만화책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI학교 학급 규칙을 잘 안 지킨다.6학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간건강핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로학교 시설물을 아끼지 않는다.6학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님안한다.성적독서친구들과 사이 좋게 지낸다.진로, 디지털·AI학교 학급 규칙을 잘 안 지킨다.6학년1순위3순위2순위거의 도움 주시지 않는다.1~2권소설, 문학책친구2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로학교 학급 규칙을 잘 안 지킨다.4학년2순위3순위1순위매일 확인하고 도와주신다.3~4권만화책부모님2~3시간버릇독서학교 학급 규칙을 잘 지킨다.디지털·AI실내에서 뛰어다닌다.4학년1순위2순위3순위매일 확인하고 도와주신다.5권 이상과학책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.문화예술, 진로실내에서 뛰어다닌다.4학년2순위1순위3순위거의 도움 주시지 않는다.5권 이상과학책부모님1시간 이하건강TV 시청실내에서 질서 있게 행동한다.민주시민, 토의·토론실내에서 뛰어다닌다.4학년2순위1순위3순위매일 확인하고 도와주신다.5권 이상과학책부모님1시간 이하건강운동친구들과 사이 좋게 지낸다.문화예술, 과학 해결욕을 많이 하고 폭력적이다.4학년2순위1순위3순위매일 확인하고 도와주신다.1~2권위인전부모님1시간 이하버릇핸드폰친구들과 사이 좋게 지낸다.진로, 인성실내에서 뛰어다닌다.4학년3순위2순위1순위매일 확인하고 도와주신다.3~4권동화책부모님1시간 이하공부핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.4학년2순위1순위3순위가끔 확인하고 도와주신다.1~2권동화책부모님2~3시간성적핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI쓰레기를 함부로 버린다.4학년1순위3순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간건강핸드폰친구들과 사이 좋게 지낸다.진로, 인성학교 학급 규칙을 잘 안 지킨다.4학년2순위1순위3순위매일 확인하고 도와주신다.3~4권과학책부모님2~3시간건강핸드폰친구들과 사이 좋게 지낸다.디지털·AI쓰레기를 함부로 버린다.4학년3순위1순위2순위매일 확인하고 도와주신다.5권 이상위인전부모님2~3시간공부TV 시청친구들과 사이 좋게 지낸다.진로쓰레기를 함부로 버린다.4학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하친구문제핸드폰친구들과 사이 좋게 지낸다.문화예술, 독서·인문실내에서 뛰어다닌다.4학년3순위1순위2순위매일 확인하고 도와주신다.5권 이상과학책부모님안한다.건강독서실내에서 질서 있게 행동한다.문화예술, 독서·인문실내에서 뛰어다닌다.4학년2순위1순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하성적운동친구들과 사이 좋게 지낸다.체육활동학교 학급 규칙을 잘 안 지킨다.4학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간건강컴퓨터친구들과 사이 좋게 지낸다.민주시민, 세계시민실내에서 뛰어다닌다.4학년2순위1순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간외모운동친구들과 사이 좋게 지낸다.문화예술, 진로욕을 많이 하고 폭력적이다.4학년1순위가끔 확인하고 도와주신다.3~4권만화책부모님2~3시간성격독서학교 학급 규칙을 잘 지킨다.디지털·AI실내에서 뛰어다닌다.4학년2순위3순위1순위매일 확인하고 도와주신다.3~4권동화책부모님1시간 이하친구문제운동학교 학급 규칙을 잘 지킨다.문화예술, 독서·인문욕을 많이 하고 폭력적이다.4학년1순위2순위3순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님1시간 이하건강독서학교 학급 규칙을 잘 지킨다.독서·인문, 인성쓰레기를 함부로 버린다.5학년2순위3순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책친구2~3시간외모핸드폰학교 시설물을 아낀다.문화예술학교 학급 규칙을 잘 안 지킨다.5학년3순위1순위2순위매일 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간친구문제핸드폰친구들과 사이 좋게 지낸다.진로, 인성욕을 많이 하고 폭력적이다.5학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책형제2~3시간가족문제운동학교 시설물을 아낀다.체육실내에서 뛰어다닌다.5학년1순위매일 확인하고 도와주신다.0권만화책부모님5시간 이상성격핸드폰친구들과 사이 좋게 지낸다.디지털·AI욕을 많이 하고 폭력적이다.5학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님3~4시간성적컴퓨터친구들과 사이 좋게 지낸다.문화예술학교 학급 규칙을 잘 안 지킨다.5학년3순위2순위1순위가끔 확인하고 도와주신다.5권 이상만화책형제1시간 이하버릇운동친구들과 사이 좋게 지낸다.토의·토론실내에서 뛰어다닌다.5학년1순위2순위3순위매일 확인하고 도와주신다.1~2권과학책부모님1시간 이하공부독서친구들과 사이 좋게 지낸다.인성, 디지털·AI학교 학급 규칙을 잘 안 지킨다.5학년2순위3순위1순위매일 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간건강핸드폰친구들과 사이 좋게 지낸다.기초소양, 인성실내에서 뛰어다닌다.5학년3순위1순위2순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간외모핸드폰학교 학급 규칙을 잘 지킨다.문화예술실내에서 뛰어다닌다.5학년1순위2순위3순위매일 확인하고 도와주신다.1~2권위인전부모님5시간 이상건강TV 시청친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.5학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간공부핸드폰학교 시설물을 아낀다.디지털·AI, 토의·토론실내에서 뛰어다닌다.5학년1순위2순위3순위매일 확인하고 도와주신다.3~4권만화책부모님2~3시간건강독서친구들과 사이 좋게 지낸다.진로, 디지털·AI쓰레기를 함부로 버린다.5학년1순위2순위3순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님2~3시간친구문제핸드폰학교 학급 규칙을 잘 지킨다.인성, 생태전환실내에서 뛰어다닌다.5학년3순위1순위2순위거의 도움 주시지 않는다.1~2권만화책부모님5시간 이상외모핸드폰친구들과 사이 좋게 지낸다.진로, 인성쓰레기를 함부로 버린다.5학년2순위1순위3순위가끔 확인하고 도와주신다.3~4권소설, 문학책부모님2~3시간성적운동친구들과 사이 좋게 지낸다.진로학교 학급 규칙을 잘 안 지킨다.5학년3순위1순위2순위가끔 확인하고 도와주신다.5권 이상과학책친구3~4시간버릇핸드폰학교 시설물을 아낀다.인성, 토의·토론학교 학급 규칙을 잘 안 지킨다.5학년2순위1순위3순위매일 확인하고 도와주신다.1~2권소설, 문학책부모님3~4시간외모핸드폰친구들과 사이 좋게 지낸다.진로, 민주시민학교 학급 규칙을 잘 안 지킨다.5학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님5시간 이상성격핸드폰친구들과 사이 좋게 지낸다.진로, 디지털·AI실내에서 뛰어다닌다.5학년2순위1순위3순위매일 확인하고 도와주신다.5권 이상소설, 문학책친구안한다.건강운동친구들과 사이 좋게 지낸다.스포츠실내에서 뛰어다닌다.5학년3순위1순위2순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님2~3시간건강TV 시청친구들과 사이 좋게 지낸다.토의·토론실내에서 뛰어다닌다.5학년3순위2순위1순위가끔 확인하고 도와주신다.1~2권소설, 문학책부모님1시간 이하친구문제독서친구들과 사이 좋게 지낸다.문화예술욕을 많이 하고 폭력적이다.5학년2순위1순위3순위가끔 확인하고 도와주신다.5권 이상소설, 문학책부모님1시간 이하건강운동친구들과 사이 좋게 지낸다.디지털·AI, 토의·토론실내에서 뛰어다닌다.`;

    setData(parseRawData(rawInput));
  }, []);

  // --- Filtering Logic ---
  const filteredData = useMemo(() => {
    if (selectedGrade === 'All') return data;
    return data.filter((d) => d.grade === selectedGrade);
  }, [data, selectedGrade]);

  // --- Chart Data Preparation ---
  const worryData = useMemo(() => {
    const counts = {};
    filteredData.forEach((d) => {
      counts[d.worry] = (counts[d.worry] || 0) + 1;
    });
    return Object.entries(counts)
      .map(([name, value]) => ({ name, value }))
      .sort((a, b) => b.value - a.value);
  }, [filteredData]);

  const screenTimeData = useMemo(() => {
    const counts = {};
    filteredData.forEach((d) => {
      counts[d.screenTime] = (counts[d.screenTime] || 0) + 1;
    });
    return Object.entries(counts).map(([name, value]) => ({ name, value }));
  }, [filteredData]);

  const problemData = useMemo(() => {
    const counts = {};
    filteredData.forEach((d) => {
      counts[d.schoolProblem] = (counts[d.schoolProblem] || 0) + 1;
    });
    return Object.entries(counts)
      .map(([name, value]) => ({ name, value }))
      .sort((a, b) => b.value - a.value);
  }, [filteredData]);

  const autonomyTopicData = useMemo(() => {
    const counts = {};
    filteredData.forEach((d) => {
      d.autonomyTopics.forEach((t) => {
        counts[t] = (counts[t] || 0) + 1;
      });
    });
    return Object.entries(counts)
      .map(([name, value]) => ({ name, value }))
      .sort((a, b) => b.value - a.value);
  }, [filteredData]);

  if (data.length === 0) return <div className="flex items-center justify-center h-screen">데이터 분석 중...</div>;

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans">
      <header className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">🏫 학생 설문조사 대시보드</h1>
        <p className="text-gray-600">
          총 <span className="font-bold text-blue-600">{data.length}</span>명의 응답 데이터 분석
        </p>
      </header>
      {/* --- Filter Buttons --- */}
      <div className="flex flex-wrap gap-2 mb-8 bg-white p-2 rounded-lg shadow-sm w-fit border border-gray-100">
        {['All', '4학년', '5학년', '6학년'].map((grade) => (
          <button
            key={grade}
            onClick={() => setSelectedGrade(grade)}
            className={`px-6 py-2 rounded-md font-medium transition-all duration-200 ${
              selectedGrade === grade ? 'bg-blue-600 text-white shadow-md' : 'bg-transparent text-gray-500 hover:bg-gray-100'
            }`}
          >
            {grade === 'All' ? '전체 보기' : grade}
          </button>
        ))}
      </div>
      {/* --- Key Metrics --- */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <Card title="현재 필터 학생 수" icon={Users} className="border-l-4 border-l-blue-500">
          <p className="text-3xl font-bold text-gray-800">{filteredData.length}명</p>
        </Card>
        <Card title="가장 많은 고민" icon={Frown} className="border-l-4 border-l-orange-500">
          <p className="text-xl font-bold text-gray-800">{worryData[0]?.name || '-'}</p>
        </Card>
        <Card title="주요 학교 문제점" icon={Search} className="border-l-4 border-l-red-500">
          <p className="text-xl font-bold text-gray-800">{problemData[0]?.name || '-'}</p>
        </Card>
        <Card title="자율시간 인기주제" icon={BookOpen} className="border-l-4 border-l-green-500">
          <p className="text-xl font-bold text-gray-800">{autonomyTopicData[0]?.name || '-'}</p>
        </Card>
      </div>
      {/* --- Charts Grid --- */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        {/* Chart 1: Worries */}
        <Card title={`${selectedGrade === 'All' ? '전체' : selectedGrade} 학생들이 가장 걱정하는 것`} icon={Frown}>
          <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <ReBarChart data={worryData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                <XAxis dataKey="name" tick={{ fontSize: 12 }} />
                <YAxis />
                <RechartsTooltip />
                <Bar dataKey="value" fill="#8884d8" name="학생 수" radius={[4, 4, 0, 0]} />
              </ReBarChart>
            </ResponsiveContainer>
          </div>
        </Card>

        {/* Chart 2: Screen Time */}
        <Card title="스마트폰/게임/인터넷 사용 시간" icon={Clock}>
          <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <PieChart>
                <Pie
                  data={screenTimeData}
                  cx="50%"
                  cy="50%"
                  outerRadius={80}
                  fill="#8884d8"
                  dataKey="value"
                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                >
                  {screenTimeData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <RechartsTooltip />
                <RechartsLegend />
              </PieChart>
            </ResponsiveContainer>
          </div>
        </Card>

        {/* Chart 3: Autonomy Topics (Tag Cloud simulation) */}
        <Card title="희망하는 자율시간 주제 (인기순)" icon={Smile}>
          <div className="flex flex-wrap gap-2">
            {autonomyTopicData.map((topic, index) => (
              <div
                key={topic.name}
                className="px-3 py-1 rounded-full text-sm font-medium flex items-center justify-between gap-2"
                style={{
                  backgroundColor: `rgba(0, 136, 254, ${1 - index * 0.1})`,
                  color: index < 5 ? 'white' : 'black',
                  border: index >= 5 ? '1px solid #eee' : 'none',
                }}
              >
                <span>{topic.name}</span>
                <span className="bg-white/20 px-1 rounded text-xs">{topic.value}</span>
              </div>
            ))}
          </div>
          <div className="mt-6 h-40">
            <ResponsiveContainer width="100%" height="100%">
              <ReBarChart data={autonomyTopicData.slice(0, 5)} layout="vertical" margin={{ left: 20 }}>
                <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                <XAxis type="number" />
                <YAxis dataKey="name" type="category" width={60} tick={{ fontSize: 12 }} />
                <RechartsTooltip />
                <Bar dataKey="value" fill="#00C49F" radius={[0, 4, 4, 0]} name="투표 수" />
              </ReBarChart>
            </ResponsiveContainer>
          </div>
        </Card>

        {/* Chart 4: School Problems */}
        <Card title="학생들이 생각하는 학교 문제점" icon={Frown}>
          <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <ReBarChart data={problemData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                <XAxis dataKey="name" tick={{ fontSize: 11 }} interval={0} />
                <YAxis />
                <RechartsTooltip />
                <Bar dataKey="value" fill="#FF8042" name="응답 수" radius={[4, 4, 0, 0]} />
              </ReBarChart>
            </ResponsiveContainer>
          </div>
        </Card>
      </div>

      {/* --- Filtered Data Table --- */}
      <Card title={`${selectedGrade === 'All' ? '전체' : selectedGrade} 상세 응답 데이터`} className="overflow-hidden">
        <div className="overflow-x-auto max-h-96">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50 sticky top-0">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">학년</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">가장 큰 걱정</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">스크린 타임</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">학교 문제점</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">자율시간 희망주제</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {filteredData.map((row) => (
                <tr key={row.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{row.grade}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{row.worry}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{row.screenTime}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{row.schoolProblem}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <div className="flex gap-1 flex-wrap">
                      {row.autonomyTopics.map((t, i) => (
                        <span key={i} className="px-2 py-0.5 rounded text-xs bg-blue-100 text-blue-800">
                          {t}
                        </span>
                      ))}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};

export default StudentInsights;

